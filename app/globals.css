@import "tailwindcss";
@import "tw-animate-css";
/* Ensure auxiliary styles are bundled in prod (must appear before any non-@import rules) */
@import url("../styles/print.css");
@import url("../styles/tiptap.css");

@custom-variant dark (&:is(.dark *));

:root {
  /* 更新颜色系统为简历编辑器专用的绿色主题 */
  --background: oklch(1 0 0);
  /* #ffffff */
  --foreground: oklch(0.35 0.01 258.34);
  /* #475569 */
  --card: oklch(0.97 0.01 258.34);
  /* #f1f5f9 */
  --card-foreground: oklch(0.35 0.01 258.34);
  /* #475569 */
  --popover: oklch(1 0 0);
  /* #ffffff */
  --popover-foreground: oklch(0.35 0.01 258.34);
  /* #475569 */
  --primary: oklch(0.45 0.15 162.4);
  /* #059669 */
  --primary-foreground: oklch(1 0 0);
  /* #ffffff */
  --secondary: oklch(0.55 0.15 162.4);
  /* #10b981 */
  --secondary-foreground: oklch(1 0 0);
  /* #ffffff */
  --muted: oklch(0.97 0.01 258.34);
  /* #f1f5f9 */
  --muted-foreground: oklch(0.35 0.01 258.34);
  /* #475569 */
  --accent: oklch(0.55 0.15 162.4);
  /* #10b981 */
  --accent-foreground: oklch(1 0 0);
  /* #ffffff */
  --destructive: oklch(0.5 0.22 12.17);
  /* #be123c */
  --destructive-foreground: oklch(1 0 0);
  /* #ffffff */
  --border: oklch(0.9 0 0);
  /* #e4e4e4 */
  --input: oklch(1 0 0);
  /* #ffffff */
  --ring: oklch(0.45 0.15 162.4 / 0.5);
  /* rgba(9, 150, 105, 0.5) */
  --chart-1: oklch(0.45 0.15 162.4);
  /* #059669 */
  --chart-2: oklch(0.55 0.15 162.4);
  /* #10b981 */
  --chart-3: oklch(0.9 0 0);
  /* #e4e4e4 */
  --chart-4: oklch(0.97 0.01 258.34);
  /* #f1f5f9 */
  --chart-5: oklch(0.35 0.01 258.34);
  /* #475569 */
  --radius: 0.5rem;
  --sidebar: oklch(1 0 0);
  /* #ffffff */
  --sidebar-foreground: oklch(0.35 0.01 258.34);
  /* #475569 */
  --sidebar-primary: oklch(0.45 0.15 162.4);
  /* #059669 */
  --sidebar-primary-foreground: oklch(1 0 0);
  /* #ffffff */
  --sidebar-accent: oklch(0.55 0.15 162.4);
  /* #10b981 */
  --sidebar-accent-foreground: oklch(1 0 0);
  /* #ffffff */
  --sidebar-border: oklch(0.9 0 0);
  /* #e4e4e4 */
  --sidebar-ring: oklch(0.45 0.15 162.4 / 0.5);
  /* rgba(9, 150, 105, 0.5) */
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.55 0.15 162.4);
  /* 深色模式下的绿色主题 */
  --primary-foreground: oklch(0.145 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.55 0.15 162.4);
  --accent-foreground: oklch(0.145 0 0);
  --destructive: oklch(0.396 0.141 25.723);
  --destructive-foreground: oklch(0.637 0.237 25.331);
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.439 0 0);
  --chart-1: oklch(0.55 0.15 162.4);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.55 0.15 162.4);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.269 0 0);
  --sidebar-ring: oklch(0.439 0 0);
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }

  body {
    @apply bg-background text-foreground;
  }

  /* Critical: restore list markers for Tiptap content in prod
     Tailwind preflight resets `ol, ul { list-style: none; padding: 0; }`.
     In some builds the auxiliary tiptap.css may be tree‑shaken —
     keep a minimal copy here to guarantee bullets/numbers render. */
  .ProseMirror ul,
  .ProseMirror ol {
    list-style-position: outside !important;
    padding-left: 1.5rem !important;
    margin: 0 !important;
  }

  .ProseMirror ul {
    list-style-type: disc !important;
  }

  .ProseMirror ol {
    list-style-type: decimal !important;
  }

  .ProseMirror li {
    display: list-item !important;
    list-style: inherit !important;
    margin: 0 !important;
  }

  .ProseMirror li p {
    display: inline !important;
    margin: 0 !important;
  }
}

/* Robust print fallbacks live in global CSS to guarantee inclusion in prod */
@media print {

  html,
  body {
    height: auto !important;
    overflow: visible !important;
    background: #fff !important;
  }

  /* Never print chrome/headers/toolbars */
  .no-print {
    display: none !important;
  }

  /* Remove fixed heights/scrolls from preview containers */
  .pdf-preview-page-root,
  .pdf-preview-page-root .h-screen,
  .pdf-preview-page-root .min-h-screen,
  .pdf-preview-page-root .overflow-hidden,
  .pdf-preview-page-root .flex-1,
  .pdf-fallback-container,
  .pdf-fallback-container .pdf-preview-mode {
    height: auto !important;
    overflow: visible !important;
  }

  /* Ensure the resume page prints clean */
  .pdf-preview-mode .resume-content {
    width: auto !important;
    max-width: none !important;
    margin: 0 !important;
    padding: 0 !important;
    box-shadow: none !important;
    border: none !important;
    background: #fff !important;
  }

  /* Typography fallbacks: keep spacing consistent in headless Chromium */
  body {
    /* unify font with app's local font to avoid metric drift */
    font-family: var(--font-noto-sans), system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Noto Sans CJK SC", "Microsoft YaHei", sans-serif !important;
    line-height: 1.55 !important;
    font-size: 11pt !important;
    color: #000 !important;
  }

  .resume-content .ProseMirror>p {
    margin: 0 0 5pt 0 !important;
    line-height: 1.6 !important;
  }

  /* 顶层列表块：给予外边距，参与与段落的上下间距计算 */
  .resume-content .ProseMirror>ul,
  .resume-content .ProseMirror>ol {
    margin: 0 0 5pt 0 !important;
  }

  /* 列表项：仅为非最后一项设置项内间距，避免与列表块 margin 叠加导致段后过大 */
  .resume-content .ProseMirror li:not(:last-child) {
    margin-bottom: 5pt !important;
    line-height: 1.6 !important;
  }

  @page {
    size: A4;
    margin: 1cm;
  }
}

/* 添加简历编辑器专用样式 */
@layer components {
  .resume-editor {
    @apply h-screen flex flex-col;
  }

  .editor-toolbar {
    @apply border-b bg-card px-6 py-3 flex items-center justify-between;
  }

  .editor-content {
    @apply flex-1 flex overflow-hidden;
  }

  .editor-panel {
    @apply flex-1 border-r bg-background overflow-y-auto;
  }

  .preview-panel {
    @apply bg-muted/30 overflow-y-auto;
  }

  .resume-preview {
    @apply w-3xl mx-auto bg-white shadow-lg p-8;
  }

  /* 预览样式移至 styles/print.css，避免重复定义 */

  .pdf-preview-container {
    @apply w-full h-[70vh] overflow-hidden;
  }

  /* 回退模式（浏览器打印）的可滚动预览容器 */
  .pdf-fallback-container {
    @apply w-full h-full overflow-y-auto;
  }

  .section-card {
    @apply bg-card border rounded-lg p-4 mb-4 shadow-sm;
  }

  .section-header {
    @apply flex items-center justify-between mb-3;
  }

  .section-title {
    @apply font-medium text-card-foreground;
  }

  .form-group {
    @apply space-y-2 mb-4;
  }

  .form-label {
    @apply text-sm font-medium text-muted-foreground;
  }

  .icon-button {
    @apply inline-flex items-center justify-center w-8 rounded-md hover:bg-accent/10 transition-colors;
  }

  .icon-button-personal-info {
    @apply inline-flex items-center justify-center w-8 h-[72px] rounded-md hover:bg-accent/10 transition-colors;
  }

  /* 拉丁/数字优先的无衬线字体，cap-height 更高，和 SVG 图标更匹配 */
  .font-latin {
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
  }

  /* ---- Preview spacing (restored for production stability) ---- */
  /* Ensure top-level paragraphs inside preview have consistent spacing */
  .resume-preview.resume-content .ProseMirror>p {
    margin: 0 0 0.6em 0 !important;
    line-height: 1.6 !important;
  }

  /* Top-level lists get the same block spacing */
  .resume-preview.resume-content .ProseMirror>ul,
  .resume-preview.resume-content .ProseMirror>ol {
    margin: 0 0 0.6em 0 !important;
  }

  /* When a paragraph follows a list, add symmetric leading */
  .resume-preview.resume-content .ProseMirror>ol+p,
  .resume-preview.resume-content .ProseMirror>ul+p {
    margin-top: 0.6em !important;
  }

  /* List item internal spacing */
  .resume-preview.resume-content li:not(:last-child) {
    margin-bottom: 0.6em !important;
    line-height: 1.6 !important;
  }

  /* Center single-line content inside grid cells (min-height:40px from tiptap) */
  .resume-preview.resume-content .resume-module .grid>div .ProseMirror {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  /* In grid cells, remove trailing block margin so centering is visually balanced */
  .resume-preview.resume-content .resume-module .grid>div .ProseMirror>p:last-child,
  .resume-preview.resume-content .resume-module .grid>div .ProseMirror>ul:last-child,
  .resume-preview.resume-content .resume-module .grid>div .ProseMirror>ol:last-child {
    margin-bottom: 0 !important;
  }

  /* PDF 预览样式移至 styles/print.css，避免重复定义 */

  .space-y-\[0\.3em\]> :where(:not([hidden]) ~ :not([hidden])) {
    margin-block-start: 0.3em !important;
    margin-top: 0.3em !important;
  }

  /* 编辑器（左侧 RichTextInput）内的段落/列表垂直节距：
     仅在根级段落与列表之间增加对称的段后间距，避免“p 无上边距”
     导致与前一有序列表贴得过紧的问题；不影响嵌套列表。 */
  .rt-editor.ProseMirror>p {
    margin: 0 0 0.6em 0 !important;
  }

  .rt-editor.ProseMirror>ul,
  .rt-editor.ProseMirror>ol {
    margin: 0 0 0.6em 0 !important;
  }

  .rt-editor.ProseMirror>ol+p,
  .rt-editor.ProseMirror>ul+p {
    margin-top: 0.6em !important;
  }

  .rt-editor.ProseMirror>p:last-child,
  .rt-editor.ProseMirror>ul:last-child,
  .rt-editor.ProseMirror>ol:last-child {
    margin-bottom: 0 !important;
  }

  /* Ensure row spacing in resume preview consistently uses 0.6em
     even when Tailwind's `space-y-[0.3em]` utility is present.
     Some production builds (e.g. Vercel) may end up applying the
     utility after our print styles due to layer ordering, which
     results in smaller gaps. This rule lives after the utility
     override above so it wins in the cascade. */
  .resume-preview.resume-content .resume-module .grid+.grid,
  .pdf-preview-mode .resume-content .resume-module .grid+.grid {
    margin-top: 0.6em !important;
  }
}